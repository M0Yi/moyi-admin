# Iframe Shell 功能需求分析

## 一、拖动功能分析

### 1.1 当前实现
- **现状**：Iframe Shell 是固定居中的模态框（居中显示，不可拖动）
- **尺寸**：最大宽度 1280px，高度 90vh
- **定位**：使用 `position: fixed` + `flex` 居中

### 1.2 使用场景分析

#### ✅ **支持拖动的理由**
1. **多任务场景**
   - 用户可能需要同时查看主页面和弹窗内容
   - 拖动后可以露出主页面部分区域，方便对比数据

2. **大屏用户**
   - 在 1920px+ 屏幕上，固定居中可能不够灵活
   - 拖动可以让用户自定义位置，提升使用体验

3. **参考竞品**
   - 大多数现代管理后台（如 Ant Design Pro、Element Admin）都支持拖动
   - 用户习惯已经形成

#### ❌ **不支持拖动的理由**
1. **主要使用场景是表单操作**
   - CRUD 创建/编辑表单通常需要全屏专注
   - 拖动功能可能分散注意力

2. **移动端体验**
   - 移动端不支持拖动（触摸操作复杂）
   - 需要额外的响应式处理

3. **开发维护成本**
   - 需要处理拖动边界、多实例冲突
   - 需要保存位置状态（localStorage）
   - 增加代码复杂度

### 1.3 产品建议

**建议：支持拖动，但作为可选功能**

**理由：**
- ✅ 提升用户体验，特别是大屏用户
- ✅ 技术实现相对简单（使用 `draggable` API）
- ✅ 不影响现有功能，向后兼容

**实现方案：**
```javascript
// 配置项
{
    draggable: true,  // 默认开启
    rememberPosition: true  // 记住位置（可选）
}
```

**优先级：** ⭐⭐⭐ (中等优先级)

---

## 二、多层 Iframe Shell 嵌套分析

### 2.1 当前实现
- **现状**：技术上已支持嵌套（代码中有"套娃挑战"示例）
- **限制**：单实例模式（同时只能打开一个 Iframe Shell）

### 2.2 使用场景分析

#### ✅ **支持多层嵌套的理由**
1. **复杂业务流程**
   - 场景：在编辑用户时，需要选择角色 → 角色列表 → 创建新角色
   - 流程：用户编辑页 → 选择角色弹窗 → 创建角色弹窗（三层嵌套）

2. **关联数据选择**
   - 场景：创建订单时选择商品 → 商品详情 → 商品分类管理
   - 需要逐层深入，但不想丢失上下文

3. **参考竞品**
   - Ant Design Modal 支持多层嵌套
   - Element UI Dialog 支持多层嵌套

#### ❌ **不支持多层嵌套的理由**
1. **用户体验问题**
   - 多层嵌套会导致：
     - 弹窗越来越小（每层都有 padding）
     - 背景遮罩层叠，屏幕变暗
     - 用户容易迷失层级关系

2. **实际业务场景有限**
   - 大多数 CRUD 操作只需要 1-2 层
   - 超过 3 层的情况极少

3. **技术复杂度**
   - 需要管理多个实例的状态
   - 需要处理 z-index 层级
   - 需要处理消息通信（postMessage）的层级关系
   - 需要处理 ESC 键关闭（关闭哪一层？）

4. **更好的替代方案**
   - **方案 1**：使用 TabManager 打开新标签页
     - 用户编辑页 → 点击"选择角色" → 新标签打开角色列表
     - 优点：不遮挡，可以并排查看
   - **方案 2**：使用侧边抽屉（Drawer）
     - 从右侧滑出，不遮挡主要内容
   - **方案 3**：使用内联表单
     - 在页面内展开，不使用弹窗

### 2.3 产品建议

**建议：不支持多层嵌套，但提供更好的替代方案**

**理由：**
1. ❌ 用户体验差（弹窗越来越小，容易迷失）
2. ❌ 实际业务场景有限（大多数只需要 1-2 层）
3. ❌ 技术复杂度高（状态管理、消息通信、层级处理）
4. ✅ 有更好的替代方案（TabManager、Drawer、内联表单）

**替代方案优先级：**

| 方案 | 适用场景 | 优先级 |
|------|---------|--------|
| **TabManager 新标签** | 需要长时间操作、需要对比数据 | ⭐⭐⭐⭐⭐ |
| **侧边抽屉（Drawer）** | 需要查看详情但不遮挡主内容 | ⭐⭐⭐⭐ |
| **内联表单展开** | 简单表单，不需要弹窗 | ⭐⭐⭐ |
| **当前 Iframe Shell** | 快速操作、简单表单 | ⭐⭐⭐⭐⭐ |

**实现建议：**
1. **保持单实例模式**（同时只能打开一个 Iframe Shell）
2. **提供"在新标签打开"按钮**（已有实现）
3. **未来考虑添加 Drawer 组件**（侧边抽屉，适合详情查看）

**优先级：** ⭐ (低优先级，不推荐实现)

---

## 三、功能优先级总结

### 3.1 推荐实现的功能

| 功能 | 优先级 | 开发成本 | 用户价值 | 建议 |
|------|--------|---------|---------|------|
| **拖动功能** | ⭐⭐⭐ | 低 | 中 | ✅ 建议实现 |
| **多层嵌套** | ⭐ | 高 | 低 | ❌ 不建议实现 |

### 3.2 功能实现建议

#### 1. 拖动功能实现
```javascript
// 配置项
{
    draggable: true,  // 默认开启
    rememberPosition: true,  // 记住位置（可选）
    dragHandle: '.iframe-shell-header'  // 拖动句柄（标题栏）
}
```

**实现要点：**
- 使用原生 `draggable` API 或 `mousedown` + `mousemove`
- 限制拖动范围（不能拖出视口）
- 可选：记住位置（localStorage）
- 移动端禁用拖动

#### 2. 多层嵌套（不推荐）
如果确实需要，建议：
- 限制最大嵌套层数（如 3 层）
- 每层缩小 10-15%
- 提供层级指示器（如 "第 2 层"）
- ESC 键关闭最顶层

但更推荐使用 **TabManager 新标签** 方案。

---

## 四、最终建议

### 4.1 短期（当前版本）
- ✅ **实现拖动功能**（提升用户体验，成本低）
- ❌ **不实现多层嵌套**（用户体验差，成本高）

### 4.2 中期（下个版本）
- ✅ 优化"在新标签打开"功能（已有，继续优化）
- ✅ 考虑添加 **Drawer（侧边抽屉）** 组件（替代多层嵌套）

### 4.3 长期
- ✅ 根据用户反馈决定是否需要多层嵌套
- ✅ 如果确实需要，优先考虑 Drawer 方案

---

## 五、参考竞品

### 5.1 拖动功能
- ✅ **Ant Design Modal**：支持拖动
- ✅ **Element UI Dialog**：支持拖动
- ✅ **Bootstrap Modal**：不支持（但第三方插件支持）

### 5.2 多层嵌套
- ✅ **Ant Design Modal**：支持（但官方不推荐超过 3 层）
- ✅ **Element UI Dialog**：支持（但官方不推荐超过 3 层）
- ⚠️ **大多数产品**：不推荐多层嵌套，建议使用其他方案

---

## 六、结论

1. **拖动功能**：✅ **建议实现**
   - 用户价值：中等
   - 开发成本：低
   - 优先级：⭐⭐⭐

2. **多层嵌套**：❌ **不建议实现**
   - 用户价值：低
   - 开发成本：高
   - 更好的替代方案：TabManager 新标签、Drawer 抽屉
   - 优先级：⭐

**推荐方案：**
- 实现拖动功能
- 保持单实例模式（不支持多层嵌套）
- 优化"在新标签打开"功能
- 未来考虑添加 Drawer 组件

